<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MiniDu - Nauka angielskiego (MVP)</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 1rem; }
      .card{ border:1px solid #ddd; padding:1rem; border-radius:8px; max-width:600px }
      button{ padding:0.5rem 1rem }
    </style>
  </head>
  <body>
    <h1>MiniDu — prosty trener angielskiego</h1>
    <div id="app" class="card">
      <p id="lessonTitle">Wczytywanie lekcji…</p>
      <div id="questionArea"></div>
    </div>

    <script>
      async function loadLesson(){
        const res = await fetch('/api/lesson/0');
        if(!res.ok){ document.getElementById('lessonTitle').innerText = 'Nie znaleziono lekcji'; return }
        const lesson = await res.json();
        document.getElementById('lessonTitle').innerText = lesson.title;
        renderQuestion(lesson.questions[0], lesson.id);
      }

      function renderQuestion(q, lessonId){
        const area = document.getElementById('questionArea');
        area.innerHTML = '';
        const p = document.createElement('p');
        p.innerText = q.prompt;
        area.appendChild(p);
        q.choices.forEach((c, idx)=>{
          const btn = document.createElement('button');
          btn.innerText = c;
          btn.onclick = async ()=>{
            const resp = await fetch('/api/check', {
              method: 'POST',
              headers:{'Content-Type':'application/json'},
              body: JSON.stringify({lesson_id: lessonId, question_id: q.id, answer: idx})
            });
            const j = await resp.json();
            if(j.correct) alert('Dobrze!'); else alert('Źle — poprawna odpowiedź: ' + q.choices[j.correct_answer]);
          };
          area.appendChild(btn);
        })
      }

      loadLesson();
    </script>
  </body>
</html>
